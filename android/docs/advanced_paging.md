# ページングに対応する

レシピ一覧用のAPIや、お気に入り一覧用のAPIにはページネーションのための実装が含まれています。

本編をクリアするだけではこれらの実装は含まれていませんでしたが、アプリの使い勝手としてはページングがないと使い物になりません。

今回は以下のような機能を想定しています。

- レシピ一覧画面で、最下部までスクロールしたときに「さらに読み込む」を表示する
- 「さらに読み込む」をタップすると、次のページのレシピが読み込まれる
- 読み込む対象のレシピがなくなった場合、「さらに読み込む」を非表示にする

これを実装してみましょう。

一応、以下に実装のヒントを書いておきます。できる人は見ずに進めても構いません。
また、上の仕様に必ず沿う必要もありません。一番良いと思った機能を実装をしてみてください。

## ヒント

実装で詰まるだろう箇所にヒントを残していきます。
応用課題では実装例は載せないので、調べたりメンターに聞いたりして自力で解決してみましょう。

- GraphQLのクエリ定義にパラメータを渡すときの記法は、 RecipeQuery.graphql を参考にすると良いでしょう
- 表示したい要素を足したいときは、GroupieのItemを新たに定義して、必要な箇所で追加すると良いでしょう
  - 例えば、 LoadingItem とか良いかもしれません
- Groupieには、Sectionという概念があるのでそれを使うとうまく実装できるかもしれません
  - `section.setFooter(footerItem)` `section.removeFooter()` あたりが使えそうです
- LoadingItem がタップされたときに、次のページを読み込むにはどうすればよいでしょうか？
  - LoadingItem の中で読み込んでも、Adapterに値を追加することは出来ません
  - RecipeListFragment 側で処理を行う必要がありそうです
  - Kotlinでは、関数をオブジェクトとしてメソッドやコンストラクタ引数に渡すことが出来ます
- 「今何ページ目を読み込んだか」「次何ページ目を読み込む必要があるのか」を知る必要があります
  - RecipesのAPIではそれらの情報は返ってこないのでアプリケーション側で管理をする必要があります
  - `loadRecipes(page: Int)` のようなメソッドがあると再利用できそうですね
- 次ページ読み込みの終端条件は、APIで返ってきたレシピが0件だったら、とするのがひとまず良さそうです

## さらに応用

- 一番下までスクロールしたときに自動的に次ページを読み込むにはどうすればよいでしょう？
- 読み込み中には「読み込み中」と表示させるのが良さそう
- エラーが起きたら「再読み込み」できるようになっているとさらに良さそう
